# lunch-location
본 연구는 경희대학교 ``데이터마이닝`` 수업에서 진행되었습니다.

## Overview

2개월간의 경도 & 위도 정보가 담긴 시계열 위치 데이터를 가공해 학과 / 학교에 머무르는 시간 / 점심식사 가용시간 / 정문과의 거리 / 기숙사 거주 여부 와 같은 파생 변수를 만들었고, Decision Tree를 구축해 교내에서 식사하는 사람들의 특징을 분석했습니다. 그리고 이들을 배달 앱 잠재 고객군으로 설정 후 타겟 마케팅 전략을 수립했습니다.

## Method
어플리케이션을 이용해 수집한 해당 데이터 소유자가 해당 날에 밖에서 밥을 먹었는지, 안에서 먹었는지 확인합니다. 그날의 생활 패턴을 파악한 후 선정한 attribute (정문과의 거리, 가용 시간의 길이, 기숙사 거주 여부, 날씨, 미세먼지)를 통해 Target attribute인 점심 식사 위치 (outside/inside) 상관성을 분석합니다. 교내에서 식사한 사람의 경우, 배달을 시켜먹을 가능성이 있다고 판단합니다. 해당 target을 발견하기 위해 Classification Analysis에 기반한 model을 만들어 Target을 예측합니다.

### Data

* Raw data
  - Latitude, Longitude, Elevation, Timestamp

* 처리용 data
  - Date, Startpoint, Endpoint, Difference, Place

* 최종 data
  - Key, Date, Day, AvailableTime, Distance, AirScore, WeatherScore, Dorm, IOS
    - **IOS**: Label, **식사 위치 Inside/Outside**

### Codes
- **preprocessing.R**: Mapmywalk 앱을 통해 얻은 원본 파일의 전처리를 진행하는 코드입니다.

- **data_place.R**: 각 건물마다 좌표를 지정해 구역을 설정한 후, 특정 구역으로 이동할 때마다 start point와 end point를 잡고 place에 미리 지정해둔 건물의 번호를 작성하는 코드입니다.

```
-1 out
0 else (가용시간)
1 우정원 위도: 37.24548 ~ 37.24640 / 경도: 127.07588~ 127.07747
2 제2기숙사 여자동 위도: 37.24329~ 37.24400 / 경도: 127.07590 ~ 127.07781
3 제2기숙사 남자동 위도: 37.242199~ 37.24292 / 경도: 127.07680 ~ 127.077625
4 학생회관 위도: 37.24168~37.24227 / 경도: 127.07935~127.08044
5 멀티미디어관 위도: 37.24430~ 37.24488 / 경도: 127.07588~127.07697
6 공과대학 위도: 37.24532~37.24743 / 경도: 127.07993~127.08142
7 전자정보대학: 37.23878~37.23983 / 경도: 127.08279~127.08396
8 예술디자인대학 위도: 37.24131~37.24214 / 경도:127.08389~127.08514
9 국제대학 위도: 37.24184~37.24234 / 경도: 127.08086~127.08167
10 생명과학대학 위도: 37.24266~37.24306 / 경도: 127.08080~127.08177
11 체육대학: 37.24384~37.24488 / 경도: 127.07987~127.08083
12 외국어대학: 37.24476~37.24546 / 경도: 127.07693~127.07836

100~1200 : 해당 구역에서 갑작스럽게 20분 이상 나간 경우
10000: 어떤 구역인지 알 수 없으나 갑작스럽게 20분 이상 나간 경우
-1: 정문을 거쳐 나간 경우 (out: 정문 거쳤는지 알아보는 함수)
```

-	**exception_handling.R**: data_place 코드를 거친 후에 csv 파일을 보면 휴대폰 GPS 및 애플리케이션의 한계로 인해 위치가 불안정하게 움직이면서 예를 들어 실제 사용자는 1에 위치하지만 0 1 0 1 0 1 0 처럼 place가 반복되어 나타나는 경우가 발생합니다.  이런 경우 등의 다양한 예외를 처리해주기 위하여 해당 코드를 이용해  전처리를 진행해 보다 깔끔하게 시간에 따른 place 값을 얻을 수 있게 해주는 코드입니다.

-	**get_available_time.R**: key를 생성하고, 가용시간의 요일별 평균을 구해 키, 날짜, 요일, 가용시간을 csv에 저장합니다.

-	**get_weather.py**: 네이버 날씨에서 웹 크롤링을 파이썬으로 진행하는 코드입니다. 3,4,5월을 각각 진행하였으며, 최종 아웃풋은 점수로 변환되어 리스트 형식으로 반환되게 됩니다. 결과로 도출된 리스트를 adding_weather.R로 복사하여 csv에 추가합니다. 이때 R에서는 리스트가 아닌 벡터 형태로 데이터를 사용하게 됩니다.

-	**get_air.R**: 경기도 대기환경 정보의 영통구 시간대별 csv파일을 Input으로 받습니다. 데이터 중, 11시부터 2시까지의 데이터만 추출하여 평균을 낸 후 날짜별로 정리하고, 평균을 점수로 변환하여 벡터 형식으로 반환합니다. 이때, 결과로 도출된 벡터를 adding_weather.R로 복사하여 날씨 정보와 함께 csv에 추가합니다.

-	**get_dorm.R**: 기숙사 여부 attribute를 도출하는 코드입니다. Input파일은 처리용 csv파일이며, output은 Bool형식으로 처리하여, 기숙사생 key의 dorm attribute에 1을, 기숙상이 아닌 key의 dorm attribute에는 0을 반환합니다.

-	**get_distance.R**: place attribute에 따른 점심시간 정문과의 거리 attribute를 도출하는 코드입니다.

-	**adding_weather.R**: 크롤링한 날씨, 미세먼지 벡터의 값을 날짜에 맞게 csv에 추가하는 코드입니다.

- **distance.R**: 정문과의 거리 attribute를 도출하기 위한 코드입니다.
  - 기본적으로 점심시간의 거점(수업과 같이 오래 머무르는 원인을 제공하는 중심 지점)의 위치가 정문과 가까울수록 나가서 먹기 용이할 것이라는 전제에서 출발했습니다. 식사 전 뿐만 아니라 식사 후에 돌아오는 경우도 고려되야 했기에 점심시간 (11-14시) 내의 거점들의 평균 좌표를 산출한 후 이 좌표와 정문의 좌표간의 거리를 m 단위로 출력합니다.

-	**data_ios.R**: Target attribute인 IOS를 제외한 나머지 모든 애트리뷰트를 가지고 있는 csv와 key_plus 이후 생성된 csv 파일을 함께 이용하여 IOS값을 채워넣는 코드입니다. 이때 2개의 csv 파일에는 한 열에 고유 키 값이 작성되어 있어서 IOS값을 결정할 때 사용되는 기숙사 여부를 참고할 때 해당 키 값으로 두 csv파일을 매칭시켜 사용합니다.

```
전제)
1. 11-14 사이에 만드시 식사는 한 번 한다.
2. 학관/제2기숙사가 있으면 무조건 IS로 한다. (동아리 활동 등 기타 활동 인정하지 않음)
3. 단, 기숙사생의 경우-하교할 일이 없으므로 그냥 무조건 OS처리하면 된다 생각함.
```
```
[기준: 11시 ~ 14시]
1. 나간 적 없는 경우 = 1
2. 나간 적 있는 경우
  1) 제2긱 기숙사생 = 0
  2) 제2긱 기숙사생이 아닌 경우
      (1) 학관/제2긱에 20분 이상 머무른 경우 = 1
      (2) 학관/제2긱에 20분 이상 머무르지 않은 경우
            가. 11시~ 14시 사이에 나갔다 들어온 경우 = 0
            나. 11시 ~ 14시 사이에 나갔으나 14시 내로 들어오지 않은 경우
                  ㄱ. 14시 이후에 학교 되돌아온 경우 = 0
                  ㄴ. 14시 이후에 학교 되돌아오지 않은 경우 = 1
            다. 11시 이전부터 나간경우
                  ㄱ. 12시 30분 기준으로 이전에 들어온 경우 = 1
                  ㄴ. 12시 30분 기준으로 이전에 돌아오지 않은 경우 = 0
3. 해당 시간동안 데이터가 존재하지 않는 경우 = 0
   * 해당 예외처리는 이후 Modeling.R 파일에서 Distance 값을 이용해 바꾼다. 현재 코드에서는 3번의 경우는 1로 처리됩니다.

위 기준을 통해 IS, OS 를 판단합니다.
```
-	**date_cleaning.R**: csv에서 데이터 수집기간 외 데이터와 주말 데이터를 삭제하는 코드입니다.

-	**Modeling.R**: Decision Tree에서 해당 학생이 점심을 교내에서 먹을지, 교외에서 먹을지 예측합니다.
    - 모델링할때는 training set, test set을 7:3의 비율로 나누어 진행합니다.

## Result
가용시간, 정문과의 거리, 날씨 여부, 미세먼지 정도, 기숙사 거주 여부 총 5개의 Attribute를 가지고 의사결정 나무 모델을 생성했습니다. Test set을 넣어 분석한 결과 도출해낸 모델은 약 75.17%의 정확도와 3.246e-08의 p-value값을 보여 유의미한 모델이라 판단하였습니다. 또한 해석을 하는 과정에 있어서 모순점이 발견되지 않아 다음과 같은 마케팅 전략을 수립하는데 유용한 모델이라 판단하였습니다.

* 첫째, 정문으로부터의 거리가 약 270m 이상인 앱 사용자들을 타겟으로 설정, 학식이 아닌 배달 음식 주문을 유도하는 push message를 보낼 수 있다.

* 둘째, 식사 위치에 대한 대략적인 가용시간 임계점인 2시간 10분을 참고, 기존 배달 시간보다 배달 시간을 줄인 대학생 대상 ‘on-time delivery’ 도입을 고려해볼 수 있다.

### Report
[Report](/report.pdf)

## Developers
* [Seoyoung Hong](https://github.com/seoyoungh)
* 박예린
* 박완재
* 윤수민
* 류연주
